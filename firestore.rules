rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    function isSignedIn() {
      return request.auth != null;
    }

    function isAuthorizedAdmin() {
      return isSignedIn() &&
        request.auth.token.email in [
          "chadnuttall1@gmail.com",
          "chad@seasaba.com",
          "katy@seasaba.com",
          "knuttall05@gmail.com",
          "timschwenck@gmail.com"
        ];
    }

    function isPublicDoc() {
      return resource.data.isPublic == true;
    }

    match /beers/{beerId} {
      allow read: if isPublicDoc() || isAuthorizedAdmin();
      allow create, update, delete: if isAuthorizedAdmin();
    }

    match /venues/{venueId} {
      allow read: if isPublicDoc() || isAuthorizedAdmin();
      allow create, update, delete: if isAuthorizedAdmin();
    }

    match /tradeLeads/{leadId} {
      allow create: if request.resource.data.keys().hasOnly([
          "businessName",
          "contactName",
          "email",
          "phoneOrWhatsapp",
          "venueType",
          "message",
          "createdAt",
          "status"
        ])
        && request.resource.data.businessName is string
        && request.resource.data.contactName is string
        && request.resource.data.email is string
        && request.resource.data.phoneOrWhatsapp is string
        && request.resource.data.venueType is string
        && request.resource.data.message is string
        && request.resource.data.status == "new";
      allow read, update, delete: if isAuthorizedAdmin();
    }

    match /{document=**} {
      allow read, write: if false;
    }
  }
}